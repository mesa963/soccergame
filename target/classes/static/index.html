<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jamm games</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>

<body>
    <div id="app">
        <!-- Pantalla de Inicio -->
        <section id="landing" class="view">
            <div class="glass-card">
                <h1 class="glow-text">"Mesa"de juegos</h1>
                <div class="input-group">
                    <input type="text" id="playerName" placeholder="Tu Nombre" maxlength="15">
                </div>

                <!-- Step 1: Choose Action -->
                <div id="landingStep1" style="display:flex; gap:10px; margin-top:20px;">
                    <button class="primary-btn" onclick="showCreateRoomUI()" style="flex:1;">Crear Sala</button>
                    <button class="secondary-btn" onclick="showJoinRoomUI()" style="flex:1;">Unirse</button>
                </div>

                <!-- Step 2: Create Room UI -->
                <div id="landingCreate" class="hidden" style="margin-top:20px;">
                    <div class="input-group" style="flex-direction: column;">
                        <label
                            style="color:white; display:block; text-align:left; font-size:0.8rem; margin-bottom:5px;">Modo
                            de Juego</label>
                        <div class="game-mode-container">
                            <div class="game-mode-card selected" onclick="selectGameMode('GUESS_WHO', this)">
                                <span class="game-mode-icon">üïµÔ∏è‚Äç‚ôÇÔ∏è</span>
                                <span class="game-mode-title">Adivina Qui√©n</span>
                            </div>
                            <div class="game-mode-card impostor-mode" onclick="selectGameMode('IMPOSTOR', this)">
                                <span class="game-mode-icon">üé≠</span>
                                <span class="game-mode-title">El Impostor</span>
                            </div>
                        </div>
                        <input type="hidden" id="gameModeSelection" value="GUESS_WHO">
                    </div>

                    <!-- Pack Selection (Guess Who) -->
                    <div id="guessWhoConfig" class="input-group" style="margin-top: 10px;">
                        <label
                            style="color:white; display:block; text-align:left; font-size:0.8rem; margin-bottom:5px;">Pack
                            de Categor√≠as</label>
                        <select id="packType" class="glass-input"
                            style="width: 100%; border: 1px solid rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.3); color: white;">
                            <option value="FUTBOL">‚öΩ F√∫tbol</option>
                            <option value="MOVIES">üé¨ Pel√≠culas</option>
                        </select>
                    </div>

                    <!-- Impostor Config -->
                    <div id="impostorConfig" class="input-group hidden"
                        style="margin-top: 10px; flex-direction:column;">
                        <div style="display:flex; gap:10px;">
                            <input type="number" id="impostorCount" placeholder="# Impostores" value="1" min="1" max="3"
                                style="flex:1; border: 1px solid rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.3); color: white;">
                            <div
                                style="flex:1; display:flex; flex-direction:column; gap:5px; color:white; font-size:0.9rem;">
                                <label style="display:flex; align-items:center;">
                                    <input type="checkbox" id="impostorHints" style="margin-right:5px;"> Pistas
                                </label>
                                <label style="display:flex; align-items:center;"
                                    title="Si activado, el impostor ver√° la categor√≠a">
                                    <input type="checkbox" id="showCategoryToImpostor" checked
                                        style="margin-right:5px;"> Mostrar Cat.
                                </label>
                            </div>
                        </div>
                        <select id="impostorCategory" class="game-select" style="margin-top:10px;">
                            <option value="RANDOM">üé≤ Aleatorio</option>
                        </select>
                    </div>

                    <div class="actions" style="margin-top:20px;">
                        <button id="btnCreateRoom" class="primary-btn">Comenzar</button>
                        <button class="secondary-btn" onclick="resetLandingUI()"
                            style="margin-top:10px; width:100%; background:transparent; border:1px solid rgba(255,255,255,0.3);">Volver</button>
                    </div>
                </div>

                <!-- Step 2: Join Room UI -->
                <div id="landingJoin" class="hidden" style="margin-top:20px;">
                    <div class="input-group">
                        <input type="text" id="joinCode" placeholder="C√≥d. de Sala" maxlength="4">
                    </div>
                    <div class="actions">
                        <button id="btnJoinRoom" class="primary-btn">Unirse</button>
                        <button class="secondary-btn" onclick="resetLandingUI()"
                            style="margin-top:10px; width:100%; background:transparent; border:1px solid rgba(255,255,255,0.3);">Volver</button>
                    </div>
                </div>

            </div>
        </section>

        <!-- Lobby de Espera -->
        <section id="lobby" class="view hidden">
            <div class="glass-card">
                <h2>Sala: <span id="displayRoomCode" class="highlight">----</span>
                    <button onclick="copyRoomCode()"
                        style="background:none; border:none; cursor:pointer; font-size:1.2rem;"
                        title="Copiar c√≥digo">üìã</button>
                </h2>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <p>Esperando a los jugadores...</p>
                    <button class="secondary-btn small-btn" onclick="refreshLobby()"
                        style="font-size: 0.8em; padding: 5px 10px;">‚Üª Actualizar</button>
                </div>
                <ul id="playerList"></ul>

                <!-- A√±adir Categor√≠a (Visible para todos) -->
                <div id="addCategorySection" class="hidden">
                    <div class="input-group">
                        <input type="text" id="newCategoryName"
                            placeholder="Nueva Categor√≠a (ej: Ganadores de 2 Mundiales)">
                        <button id="btnAddCategory" class="secondary-btn">A√±adir</button>
                    </div>
                </div>

                <!-- A√±adir Palabra Impostor (Solo Impostor Mode) -->
                <div id="addImpostorWordSection" class="hidden">
                    <div style="margin-bottom:10px; color:#ffffff; font-size:0.9rem;">
                        A√±adir a categor√≠a:
                        <select id="impostorCategorySelect" class="game-select"
                            style="padding: 5px 30px 5px 12px; font-size: 0.9rem;">
                        </select>
                    </div>

                    <div class="input-group" style="flex-direction:column; gap:5px;">
                        <input type="text" id="newImpostorWord" placeholder="Palabra (ej: Messi)" style="width:100%;">
                        <div style="display:flex; gap:5px; width:100%;">
                            <input type="text" id="newImpostorHint" placeholder="Pista (ej: El GOAT)" style="flex:1;">
                            <button id="btnAddImpostorWord" class="secondary-btn"
                                style="background:var(--primary); color:black;">A√±adir</button>
                        </div>
                    </div>
                </div>
                <div class="actions">
                    <button id="btnStartGame" class="primary-btn hidden">Empezar Juego</button>
                    <p id="waitingMsg" class="hint">Solo el anfitri√≥n puede empezar</p>
                </div>
            </div>
        </section>

        <!-- Pantalla de Juego -->
        <section id="game" class="view hidden">
            <div class="game-container">
                <header class="game-header">
                    <div class="room-info">SALA: <span id="gameRoomCode">----</span></div>
                    <div id="myStatus" class="player-badge">Adivinando...</div>
                    <div id="persistentVotingStatus" class="voting-progress-area hidden"></div>
                    <button id="btnResetGame" class="secondary-btn hidden">üîÑ Volver a Jugar</button>
                </header>

                <main class="game-grid">
                    <!-- Otros Jugadores -->
                    <div class="players-section">
                        <div class="section-header">
                            <h3>Otros Jugadores</h3>
                            <div id="turnCircleContainer" class="turn-circle-container">
                                <svg width="120" height="120" viewBox="0 0 120 120">
                                    <defs>
                                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5"
                                            orient="auto">
                                            <polygon points="0 0, 10 3.5, 0 7" fill="rgba(255,255,255,0.3)" />
                                        </marker>
                                    </defs>
                                    <circle cx="60" cy="60" r="45" fill="none" stroke="rgba(255,255,255,0.05)"
                                        stroke-width="1" stroke-dasharray="4 4" />
                                    <!-- Flecha de direcci√≥n horaria -->
                                    <path d="M 60 15 A 45 45 0 0 1 105 60" fill="none" stroke="rgba(0, 242, 255, 0.2)"
                                        stroke-width="2" marker-end="url(#arrowhead)" />
                                </svg>
                                <!-- Nombres din√°micos aqu√≠ -->
                            </div>
                        </div>
                        <div id="otherPlayers" class="players-grid"></div>
                    </div>

                    <!-- Mi Secci√≥n -->
                    <div class="my-section glass-card">
                        <h3>¬øCu√°l es tu categor√≠a?</h3>
                        <div class="secret-card">
                            <span class="lock-icon">üîí</span>
                            <p>T√∫ no sabes qu√© categor√≠a tienes.</p>
                            <p class="hint"></p>
                        </div>
                        <div class="notes-area">
                            <label for="myNotes">Posibles (S√ç):</label>
                            <textarea id="myNotes" placeholder="Candidatos probables..."></textarea>
                            <label for="myInvalidNotes" style="margin-top: 10px; display:block;">Descartados
                                (NO):</label>
                            <textarea id="myInvalidNotes" placeholder="Ya descartados..."
                                style="background: rgba(255,0,0,0.1);"></textarea>
                        </div>
                        <div class="guess-actions">
                            <button id="btnGuess" class="guess-btn">¬°Adivinar!</button>
                        </div>
                    </div>
                </main>

                <!-- Podio de Ganadores -->
                <div id="podiumArea" class="podium-area hidden">
                    <div class="podium-container glass-card">
                        <h3>üèÜ Podio de Ganadores</h3>
                        <div id="podiumList" class="podium-list"></div>
                    </div>
                </div>

                <!-- √Årea de Votaci√≥n / Validaci√≥n -->
                <div id="votingArea" class="hidden">
                    <div class="glass-card voting-card">
                        <p id="votingMsg">¬øEs correcto?</p>
                        <div class="voting-btns">
                            <button id="btnVoteCorrect" class="vote-correct">S√ç ‚úÖ</button>
                            <button id="btnVoteIncorrect" class="vote-incorrect">NO ‚ùå</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal para Adivinar -->
    <div id="guessModal" class="modal hidden">
        <div class="modal-content glass-card">
            <h3>¬øQu√© categor√≠a eres?</h3>
            <input type="text" id="guessName" placeholder="T√≠tulo de la categor√≠a">
            <div class="modal-buttons">
                <button id="btnSubmitGuess" class="primary-btn">Confirmar</button>
                <button id="btnCancelGuess" class="cancel-btn">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Volver a Jugar (Impostor) -->
    <div id="playAgainModal" class="modal hidden">
        <div class="modal-content glass-card" style="max-width: 400px;">
            <h3>Opciones de Nueva Partida</h3>
            <p style="font-size:0.9rem; margin-bottom:15px; color:#d1d5db;">Configura el siguiente juego:</p>

            <div style="display:flex; flex-direction:column; gap:10px; text-align:left;">
                <label class="play-option-card">
                    <input type="radio" name="playAgainOption" value="KEEP" checked>
                    <div>
                        <strong style="display:block; color:white;">Mantener categor√≠a actual</strong>
                    </div>
                </label>
                <label class="play-option-card">
                    <input type="radio" name="playAgainOption" value="RANDOM">
                    <div>
                        <strong style="display:block; color:white;">Cambiar a Aleatoria</strong>
                    </div>
                </label>
                <label class="play-option-card">
                    <input type="radio" name="playAgainOption" value="CHANGE">
                    <div>
                        <strong style="display:block; color:white;">Elegir nueva categor√≠a</strong>
                    </div>
                </label>
            </div>

            <select id="playAgainCategorySelect" class="game-select" disabled style="margin-top:10px; opacity: 0.5;">
                <option value="RANDOM">-- Seleccionar --</option>
            </select>

            <div style="margin-top:15px; text-align:left;">
                <label style="display:flex; align-items:center; color:white; font-size:0.9rem;"
                    title="Si activado, el impostor ver√° la categor√≠a">
                    <input type="checkbox" id="playAgainShowCategory" checked style="margin-right:8px;"> Mostrar
                    Categor√≠a al Impostor
                </label>
            </div>

            <div class="modal-buttons" style="margin-top:20px;">
                <button id="btnConfirmPlayAgain" class="primary-btn">Comenzar</button>
                <button id="btnCancelPlayAgain" class="cancel-btn">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Overlay de Eliminaci√≥n -->
    <div id="ejectionOverlay" class="overlay hidden">
        <div class="overlay-content">
            <h1 class="ejected-text">EXPULSADO</h1>
            <p id="ejectionMessage" class="subtext">Nadie te escuch√≥...</p>
            <div class="astronaut-animation" style="margin-bottom: 30px;">üë®‚ÄçüöÄ</div>
            <div>
                <button id="btnAcceptEjection" class="primary-btn"
                    style="max-width: 200px; margin: 0 auto;">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- Overlay de Game Over -->
    <div id="gameOverOverlay" class="overlay hidden">
        <div class="overlay-content">
            <h1 id="winnerTitle" class="winner-text">VICTORIA</h1>
            <p id="winnerMessage" class="subtext">Los Inocentes han ganado.</p>
            <button class="primary-btn" onclick="closeGameOver()">Continuar</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>